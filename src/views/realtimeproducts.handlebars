<div class="linea-horizontal"></div>

<div class="menu-container">
  <div class="logo">
    <a href="/">
      <img src="/img/2.png" alt="Logo de la empresa">
    </a>
  </div>
  <div class="menu">
    <span class="separator">|</span>
    <a href="/realtimeproducts" class="menu-item">Productos en Tiempo Real</a>
    <span class="separator">|</span>
    <a href="/chat" class="menu-item">Chat en Vivo</a>
    <span class="separator">|</span>
    <a href="/profile" class="menu-item">Perfil</a>
    <span class="separator">|</span>
    <a href="/logout" class="menu-item">Cerrar Sesión</a>
    <span class="separator">|</span>
  </div>
</div>

<h1>Productos en tiempo real</h1>

<div id="contenedorProductos"></div>

<div class="formulario">
  <h2>Formulario para agregar productos</h2>
  <form id="addProductForm">
    <input type="text" id="title" placeholder="Titulo" required>
    <input type="text" id="description" placeholder="Descripcion" required>
    <input type="number" id="price" placeholder="Precio" required>
    <input type="text" id="img" value="Sin Imagen">
    <input type="text" id="code" placeholder="Código" required>
    <input type="number" id="stock" placeholder="Stock" required>
    <input type="text" id="category" placeholder="Categoria" required>
    <select id="status">
      <option value="true">Activo</option>
      <option value="false">Inactivo</option>
    </select>
    <button type="submit">Enviar</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io({
    transports: ['websocket'],
    upgrade: false
  });

  socket.on('connect', () => {
    console.log('Conectado al servidor');
    socket.emit('getProducts');
  });

  socket.on('productos', (productos) => {
    console.log('Productos recibidos:', productos);
    const contenedorProductos = document.getElementById('contenedorProductos');
    contenedorProductos.innerHTML = '';

    if (productos.length === 0) {
      contenedorProductos.innerHTML = '<p>No hay productos disponibles.</p>';
    } else {
      productos.forEach((producto) => {
        const productoElement = document.createElement('div');
        productoElement.innerHTML = `
          <h3>${producto.title}</h3>
          <p>Precio: ${producto.price}</p>
          <p>Código: ${producto.code}</p>
          <p>Stock: ${producto.stock}</p>
          <button class="eliminar-btn" data-id="${producto._id}">Eliminar</button>
        `;
        contenedorProductos.appendChild(productoElement);
      });
    }

    document.querySelectorAll('.eliminar-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        console.log('Intentando eliminar producto:', btn.dataset.id);
        socket.emit('eliminarProducto', btn.dataset.id);
      });
    });

    console.log('Productos actualizados:', productos);
  });

  document.getElementById('addProductForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const producto = {
      title: document.getElementById('title').value,
      description: document.getElementById('description').value,
      price: parseFloat(document.getElementById('price').value),
      img: document.getElementById('img').value,
      code: document.getElementById('code').value,
      stock: parseInt(document.getElementById('stock').value),
      category: document.getElementById('category').value,
      status: document.getElementById('status').value === 'true',
    };
    console.log('Intentando agregar producto:', producto);
    socket.emit('agregarProducto', producto);
  });

  socket.on('productoAgregado', (mensaje) => {
    console.log('Producto agregado:', mensaje);
    alert(mensaje);
    socket.emit('getProducts');
  });

  socket.on('productoEliminado', (mensaje) => {
    console.log('Producto eliminado:', mensaje);
    alert(mensaje);
    socket.emit('getProducts');
  });

  socket.on('error', (error) => {
    console.error('Error recibido:', error);
    alert(error.message);
  });
</script>

<link rel="stylesheet" href="/css/styles.css">
